= form_for @guide, :html => { class: 'form-horizontal', role: 'form' } do |f|
  - if @guide.errors.any?
    #error_explanation
      %h2= "#{pluralize(@guide.errors.count, "error")}"
      %ul
        - @guide.errors.full_messages.each do |msg|
          %li= msg

  - if params[:action] == 'new' || params[:action] == 'create'   
    .form-group
      .col-sm-12
        = button_tag(type: 'submit', class: "btn btn-success btn-lg") do 
          %span.glyphicon.glyphicon-new-window
          Guardar
        = link_to '<span class="glyphicon glyphicon-arrow-left"></span> Regresar'.html_safe, 'javascript:history.back(-1)', class: 'btn btn-warning btn-lg'
  -if params[:action] == 'edit'
    .form-group
      .col-sm-12
        = button_tag(type: 'submit', class: "btn btn-success btn-lg") do 
          %span.glyphicon.glyphicon-new-window
          Guardar
        = link_to '<span class="glyphicon glyphicon-eye-open"></span> Ver'.html_safe, @guide, class: 'btn btn-info btn-lg'
        = link_to '<span class="glyphicon glyphicon-arrow-left"></span> Regresar'.html_safe, 'javascript:history.back(-1)', class: 'btn btn-warning btn-lg'

  .row
    .col-sm-12
      .row        
        .col-sm-4
          .panel.panel-default        
            .panel-heading
              %h3.panel-title 
                %span.glyphicon.glyphicon-lock
                %b Guia Remision - Transportista
            .panel-body              
              .col-sm-8 
                .row     
                  .has-default 
                    - number = NumberGuide.last.numero.to_i + 1
                    = f.text_field :numero_remision_guia, class: 'form-control', value: "#{number}", placeholder: '506 - 000275'                
        .col-sm-4
          .panel.panel-default
            .panel-heading
              %h3.panel-title 
                %span.glyphicon.glyphicon-calendar
                %b Fecha Emision
            .panel-body               
              .col-sm-8   
                .row          
                  = f.text_field :fecha_emision, class: 'form-control', placeholder: '2014-12-23'
        .col-sm-4
          .panel.panel-default              
            .panel-heading
              %h3.panel-title 
                %span.glyphicon.glyphicon-calendar
                %b Fecha Inicio Traslado
            .panel-body              
              .col-sm-8
                .row
                  = f.text_field :fecha_inicio_traslado, class: 'form-control', placeholder: '2014-05-15'
  .row
    .col-sm-6
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-road 
            %b Direccion Partida
        .panel-body          
          .col-sm-12
            .form-group
              = f.text_field :partida_direccion, class: 'form-control', placeholder: 'Direccion'          
          .row
            .col-sm-4            
              = f.select :partida_department_id, Department.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Departamento:'} , class: 'form-control'
            .col-sm-4
              = f.select :partida_province_id, Province.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Provincia:'}, class: 'form-control'
            .col-sm-4
              = f.select :partida_district_id, District.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Distrito:'}, class: 'form-control'          
    .col-sm-6
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-road
            %b Direccion Llegada
        .panel-body          
          .col-sm-12              
            .form-group
              = f.text_field :llegada_direccion,  class: 'form-control', placeholder: 'Direccion'
          .row
            .col-sm-4
              = f.select :llegada_department_id, Department.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Departamento:'} , class: 'form-control'             
            .col-sm-4
              = f.select :llegada_province_id, Province.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Provincia:'}, class: 'form-control'
            .col-sm-4
              = f.select :llegada_district_id, District.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Distrito:'}, class: 'form-control'
              
          
  .row
    .col-sm-6
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-plane
            %b Remitente
        .panel-body          
          .col-sm-12
            .form-group
              = f.select :sender_id, Sender.all.collect{|x| ["#{x.ruc} #{x.name_reason} #{x.identity_document}", x.id]}, {:include_blank => 'Remitente'}, class: 'form-control', placeholder: 'Apellidos y Nombres / Razon social'        

    .col-sm-6
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-plane
            %b Destinatario
        .panel-body          
          .col-sm-12
            .form-group
              = f.select :addressee_id, Addressee.all.collect{|x| ["#{x.ruc} #{x.name_reason} #{x.identity_document}", x.id]}, {:include_blank => 'Destinatario'}, class: 'form-control', placeholder: 'Apellidos y Nombres / Razon social'  

  .row
    .col-sm-12    
      .panel.panel-default  
        .panel-heading
          %h3.panel-title            
            %b
              .row
                .col-sm-2 Codigo
                .col-sm-4 Descripcion
                .col-sm-1 Cantidad
                .col-sm-1 Medida
                .col-sm-1 Peso
                .col-sm-1 Und
                .col-sm-1 Precio
                .col-sm-1 Accion
                  
        .panel-body        
          .row
            #items
              = f.fields_for :items do |item|
                = render 'item_fields', :f => item
          .form-group
            .col-sm-12
              = link_to_add_association '<span class="glyphicon glyphicon-plus"></span> Agregar'.html_safe, f, :items, class: 'btn btn-primary btn-sm'

  .row 
    .col-sm-8
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-user
            %b Datos Identificacion
        .panel-body 
          .form-group                 
            .col-sm-4            
              = f.text_field :unidad_marca_vehiculo, class: 'form-control', placeholder: 'Marca del Vehiculo'
            .col-sm-4              
              = f.select :front_id, Front.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Placa Delantera'}, class: 'form-control', placeholder: 'Placa Numero'       
            .col-sm-4
              = f.select :back_id, Back.all.collect{|x| [x.nombre, x.id]}, {:include_blank => 'Placa Trasera'}, class: 'form-control', placeholder: 'Placa Trasera'
          .form-group
            .col-sm-4
              = f.text_field :unidad_configuracion_vehicular, class: 'form-control', placeholder: 'Config Vehicular'      
            .col-sm-4              
              = f.text_field :conductor_certificado_inscripcion, class: 'form-control', placeholder: 'Certificado Inscriptcion'
            .col-sm-4              
              = f.text_field :conductor_licencia_conducir, class: 'form-control', placeholder: 'Licencia Conducir'   
          
    .col-sm-4
      .panel.panel-default  
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-user
            %b Datos Empresa Subcontatada
        .panel-body          
          .col-sm-12
            .form-group
              = f.text_field :empresa_subcontratada_nombre_apellido_razon_social, class: 'form-control', placeholder: 'Nombres y Apellidos / Razon Social'         
          .col-sm-12
            .form-group
              = f.text_field :empresa_subcontratada_ruc, class: 'form-control', placeholder: 'RUC : 123456789123'    

  .row
    .col-sm-12
      .panel.panel-default
        .panel-heading
          %h3.panel-title 
            %span.glyphicon.glyphicon-comment
            %b Observaciones
        .panel-body
          .col-sm-12
            .form-group
              = f.text_area :obsevaciones, class: 'form-control'



:javascript
  $('#guide_fecha_emision').datepicker({
      format: 'yyyy-mm-dd',
      language: 'es',
      autoclose: true      
  });
  $('#guide_fecha_inicio_traslado').datepicker({
      format: 'yyyy-mm-dd',
      language: 'es',
      autoclose: true      
  });
  $(document).ready(function() { $("#guide_sender_id").select2(); });
  $(document).ready(function() { $("#guide_addressee_id").select2(); });

  $('*').on('keydown', function(e){
      if (e.keyCode === 13) {
          var inputs = $(this).parents("form").eq(0).find(":input");
          var idx = inputs.index(this);
          if (idx == inputs.length - 1) {
              inputs[0].select()
          } else {
              inputs[idx + 1].focus(); //  handles submit buttons
              inputs[idx + 1].select();
          }
          return false;
      }
  });